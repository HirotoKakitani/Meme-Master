var hiro_database=firebase.database();function hiro_saveImage(userId,imgFlat,imgName,imgTop,imgBottom,imgRaw){var saveRef=firebase.database().ref("users/"+userId);let found=!1;saveRef.once("value").then(function(snapshot){snapshot.forEach(function(childSnapshot){if(imgName==childSnapshot.val().meme_name){let memeKey=childSnapshot.key;console.log("found in datase, updating "+memeKey);found=!0;firebase.database().ref("users/"+userId+"/"+memeKey).set({meme:imgFlat,meme_name:imgName,top_text:imgTop,bot_text:imgBottom,raw_img:imgRaw},function(error){if(error){console.log(error)}
else{window.location="main.html"}})}});if(!found){console.log("not in database, pushing new meme");var hiro_listRef=firebase.database().ref('users/'+userId);var hiro_PostRef=hiro_listRef.push();firebase.database().ref('users/'+userId+'/'+hiro_PostRef.key).set({meme:imgFlat,meme_name:imgName,top_text:imgTop,bot_text:imgBottom,raw_img:imgRaw},function(error){if(error){console.log(error)}
else{window.location="main.html"}})}});setTimeout(saveCallback,500)};function hiro_loadPreview(userId){var userList=firebase.database().ref("users/"+userId);var flatArray=[];var canvasContainer=document.getElementById("hiro_memeContainer");userList.once("value").then(function(snapshot){snapshot.forEach(function(childSnapshot){var imgNode=document.createElement("img");var titleNode=document.createElement("p");var lineNode=document.createElement("hr");imgNode.src=JSON.parse(childSnapshot.child("meme").val());imgNode.id=childSnapshot.child("meme_name").val();imgNode.onclick=function(){sessionStorage.setItem("linkFrom",childSnapshot.key);window.location="editor.html"};titleNode.innerHTML=childSnapshot.child("meme_name").val();canvasContainer.appendChild(titleNode);canvasContainer.appendChild(imgNode);canvasContainer.appendChild(lineNode)})})};function hiro_deleteMeme(userId,meme_name,delCallback){var delRef=firebase.database().ref("users/"+userId);delRef.once("value").then(function(snapshot){snapshot.forEach(function(childSnapshot){if(meme_name==childSnapshot.val().meme_name){console.log("deleting meme");let memeKey=childSnapshot.key;console.log("found in datase, deleting "+memeKey);firebase.database().ref("users/"+userId+"/"+memeKey).remove()}})});setTimeout(delCallback,500)}